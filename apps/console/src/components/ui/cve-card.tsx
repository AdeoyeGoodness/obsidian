import { Button } from './button';
import { AlertTriangle, Shield, ExternalLink } from 'lucide-react';
import { Card, CardHeader } from './card';

type CVECardProps = {
  id: string;
  cvssScore: number;
  affectedComponent: string;
  cweId?: string;
  description: string;
  mappedCAPECs?: string[];
  onMitigate?: () => void;
  onViewDetails?: () => void;
};

export function CVECard({
  id,
  cvssScore,
  affectedComponent,
  cweId,
  description,
  mappedCAPECs = [],
  onMitigate,
  onViewDetails,
}: CVECardProps) {
  const scoreColor =
    cvssScore >= 9
      ? 'text-red-400 shadow-[0_0_15px_rgba(239,68,68,0.6)]'
      : cvssScore >= 7
        ? 'text-orange-400 shadow-[0_0_15px_rgba(251,146,60,0.6)]'
        : 'text-yellow-400 shadow-[0_0_15px_rgba(234,179,8,0.6)]';

  return (
    <Card className="hover:border-red-500/50">
      <CardHeader
        title={id}
        icon={<AlertTriangle size={16} />}
        action={
          <div className={`text-3xl font-bold ${scoreColor}`} style={{ textShadow: '0 0 20px currentColor' }}>
            {cvssScore.toFixed(1)}
          </div>
        }
      />
      <div className="space-y-4">
        <div>
          <p className="text-xs text-gray-500 uppercase tracking-wider mb-1">Affected Component</p>
          <p className="text-sm font-mono text-white">{affectedComponent}</p>
        </div>

        {cweId && (
          <div>
            <p className="text-xs text-gray-500 uppercase tracking-wider mb-1">CWE</p>
            <a
              href={`https://cwe.mitre.org/data/definitions/${cweId.replace('CWE-', '')}.html`}
              target="_blank"
              rel="noopener noreferrer"
              className="text-sm text-cyan-400 hover:text-cyan-300 flex items-center gap-1"
            >
              {cweId}
              <ExternalLink size={12} />
            </a>
          </div>
        )}

        <div>
          <p className="text-xs text-gray-400 leading-relaxed line-clamp-3">{description}</p>
        </div>

        {mappedCAPECs.length > 0 && (
          <div>
            <p className="text-xs text-gray-500 uppercase tracking-wider mb-2">Mapped CAPEC</p>
            <div className="flex flex-wrap gap-2">
              {mappedCAPECs.map((capec) => (
                <span
                  key={capec}
                  className="text-xs px-2 py-1 rounded border border-purple-500/30 bg-purple-500/10 text-purple-300"
                >
                  {capec}
                </span>
              ))}
            </div>
          </div>
        )}

        <div className="flex gap-2 pt-2">
          {onMitigate && (
            <Button
              size="sm"
              icon={<Shield size={14} />}
              className="text-xs border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/10"
              onClick={onMitigate}
            >
              Mitigate
            </Button>
          )}
          {onViewDetails && (
            <Button
              size="sm"
              intent="ghost"
              icon={<ExternalLink size={14} />}
              className="text-xs border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/10"
              onClick={onViewDetails}
            >
              Details
            </Button>
          )}
        </div>
      </div>
    </Card>
  );
}

